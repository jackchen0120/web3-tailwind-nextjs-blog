---
title: 'å…¨æ ˆEchartsç”µå•†å¹³å°æ•°æ®å¯è§†åŒ–å¤§å±å®æˆ˜é¡¹ç›®'
date: '2024-03-22'
lastmod: '2024-03-22'
tags: ['å…¥é—¨æ•™ç¨‹', 'æ•°æ®å¯è§†åŒ–']
draft: false
summary: 'å‡æœŸé‡å­¦äº†æ–°ç‰ˆEchartsï¼Œä¸€ä¸ªåŸºäºJavaScriptçš„å¼€æºå¯è§†åŒ–å›¾è¡¨åº“ï¼Œæ”¶é›†å‚è€ƒäº†å¾ˆå¤šç½‘ä¸Šèµ„æ–™ï¼Œæœ€ç»ˆé€‰æ‹©ç”µå•†å¹³å°ä½œä¸ºç»ƒæ‰‹é¡¹ç›®ã€‚'
images: []
---

<TOCInline toc={props.toc} exclude="Introduction" />

## 1. å‰è¨€

> äº”ä¸€å‡æœŸé‡å­¦äº†æ–°ç‰ˆEchartsï¼Œä¸€ä¸ªåŸºäºJavaScriptçš„å¼€æºå¯è§†åŒ–å›¾è¡¨åº“ï¼Œæ”¶é›†å‚è€ƒäº†å¾ˆå¤šç½‘ä¸Šèµ„æ–™ï¼Œæœ€ç»ˆé€‰æ‹©ç”µå•†å¹³å°ä½œä¸ºç»ƒæ‰‹é¡¹ç›®ã€‚æ­¤ç¯‡æ¶‰åŠæŠ€æœ¯çŸ¥è¯†ç‚¹æœ‰ï¼šVueå…¨å®¶æ¡¶ã€WebSocketå‰åç«¯æ•°æ®æ¨é€ã€åç«¯æ¡†æ¶Koa2ã€Echartsæ–°ç‰ˆå›¾è¡¨ç»„ä»¶ï¼ˆæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ã€åœ°å›¾ã€æ•£ç‚¹å›¾ï¼‰ï¼Œè¿˜æ”¯æŒä¸»é¢˜åˆ‡æ¢, å±•ç¤ºé…·ç‚«çš„å›¾è¡¨æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæ”¯æŒå¤§å±å’Œå°å±çš„åˆ‡æ¢ï¼Œä¿è¯äº†å›¾è¡¨åœ¨ä¸åŒå±å¹•ä¸Šå‘ˆç°çš„æ•ˆæœã€‚

## 2. å…¥é—¨ç¯‡ï¼ˆæ–°æ‰‹æŒ‡å—ï¼‰

[EChartsæ•°æ®å¯è§†åŒ–å¿«é€Ÿå…¥é—¨](/blog/induction-tutorial/datav-use-course)

## 3. å®æˆ˜ç¯‡ï¼ˆä¸Šä¸‹ä¸¤éƒ¨ï¼‰

[Vue+Echartsæ„å»ºå¯è§†åŒ–å¤§æ•°æ®å¹³å°å®æˆ˜é¡¹ç›®åˆ†äº«](index.html#manual/Vue-echarts)

## 4. è¿›é˜¶ç¯‡

### 4.1 å‰åç«¯åˆ†ç¦»

å‰ç«¯é¡¹ç›®é‡‡ç”¨çš„æŠ€æœ¯æ ˆæ˜¯åŸºäºVue + Echartsï¼Œç”¨vue-cliæ„å»ºå‰ç«¯ç•Œé¢ï¼Œåç«¯é¡¹ç›®é‡‡ç”¨çš„æŠ€æœ¯æ ˆæ˜¯åŸºäºNode.js + Koa2 + WebSocketï¼Œç”¨Koa2æ­å»ºçš„åç«¯æœåŠ¡å™¨ã€‚

é™„ä¸Šè¯¦ç»†çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹ï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5cLt.png)

åˆ†äº«ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æ–°ç‰ˆ Echarts 5.xï¼Œéƒ½æœ‰å“ªäº›å˜åŒ–ï¼Œå¦‚ä¸‹å›¾ï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX52eP.png)

### 4.2 åç«¯éƒ¨åˆ†

#### 4.2.1 Koa2çš„ä»‹ç»

- åŸºäº Node.js å¹³å°çš„WebæœåŠ¡å™¨æ¡†æ¶
- ç”± Express åŸç­äººé©¬æ‰“é€ ï¼ŒExpressã€Koaã€Koa2 éƒ½æ˜¯ Web æœåŠ¡å™¨çš„æ¡†æ¶ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹å›¾ï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5Wo8.png)

- ç¯å¢ƒä¾èµ– Node v7.6.0 åŠä»¥ä¸Š ç”±äº Koa2 å®ƒæ˜¯æ”¯æŒ async å’Œ await ï¼Œæ‰€ä»¥å®ƒå¯¹ Node çš„ç‰ˆæœ¬æ˜¯æœ‰è¦æ±‚çš„ï¼Œå®ƒè¦æ±‚ Node çš„ç‰ˆæœ¬è‡³å°‘æ˜¯åœ¨7.6çº§ä»¥ä¸Š,å› ä¸ºè¯­æ³•ç³– asyncå’Œawait æ˜¯åœ¨ Node7.6 ç‰ˆæœ¬ä¹‹åå‡ºç°æ‰æ”¯æŒ
- æ´‹è‘±æ¨¡å‹çš„ä¸­é—´ä»¶ å¦‚ä¸‹å›¾æ‰€ç¤º, å¯¹äºæœåŠ¡å™¨è€Œè¨€ï¼Œå®ƒå…¶å®å°±æ˜¯æ¥å¤„ç†ä¸€ä¸ªåˆä¸€ä¸ªçš„è¯·æ±‚ï¼Œ Web æœåŠ¡å™¨æ¥æ”¶ç”±æµè§ˆå™¨å‘ è¿‡æ¥çš„ä¸€ä¸ªåˆä¸€ä¸ªè¯·æ±‚ä¹‹åï¼Œå®ƒå½¢æˆä¸€ä¸ªåˆä¸€ä¸ªçš„å“åº”è¿”å›ç»™æµè§ˆå™¨. è€Œè¯·æ±‚åˆ°è¾¾æˆ‘ä»¬çš„æœåŠ¡å™¨æ˜¯ éœ€è¦ç»è¿‡ç¨‹åºå¤„ç†çš„,ç¨‹åºå¤„ç†å®Œä¹‹åæ‰ä¼šå½¢æˆå“åº”ï¼Œè¿”å›ç»™æµè§ˆå™¨ï¼Œæˆ‘ä»¬æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„è¿™ä¸€ å—ç¨‹åºï¼Œåœ¨ Koa2 çš„ä¸–ç•Œå½“ä¸­å°±æŠŠå®ƒç§°ä¹‹ä¸ºä¸­é—´ä»¶

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5hFS.png)

è¿™ç§ä¸­é—´ä»¶å¯èƒ½è¿˜ä¸ä»…ä»…åªæœ‰ä¸€ä¸ªï¼Œå¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªï¼Œæ¯”å¦‚ä¸Šå›¾æ‰€ç¤º, å®ƒå°±å­˜åœ¨ä¸‰å±‚ä¸­é—´ä»¶ï¼Œè¿™ä¸‰ å±‚ä¸­é—´ä»¶åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä»¥åŠå®ƒè°ƒç”¨çš„é¡ºåºä¸º:

- å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾å’±ä»¬çš„æœåŠ¡å™¨ï¼Œæœ€å…ˆæœ€å…ˆå¤„ç†è¿™ä¸ªè¯·æ±‚çš„æ˜¯ç¬¬ä¸€å±‚ä¸­é—´ä»¶
- ç¬¬ä¸€å±‚çš„ä¸­é—´ä»¶åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚ç»™ç¬¬äºŒå±‚çš„ä¸­é—´ä»¶
- ç¬¬äºŒå±‚çš„ä¸­é—´ä»¶åœ¨å¤„ç†è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚ç»™ç¬¬ä¸‰å±‚çš„ä¸­é—´ä»¶
- ç¬¬ä¸‰å±‚ä¸­é—´ä»¶å†…éƒ¨å¹¶æ²¡æœ‰ä¸­é—´ä»¶äº†, æ‰€ä»¥ç¬¬ä¸‰å±‚ä¸­é—´ä»¶åœ¨å¤„ç†å®Œæ‰€æœ‰çš„ä»£ç ä¹‹åï¼Œè¿™ä¸ªè¯·æ±‚åˆä¼šåˆ°äº†ç¬¬äºŒå±‚çš„ä¸­é—´ä»¶ï¼Œæ‰€ä»¥ç¬¬äºŒå±‚ä¸­é—´ä»¶å¯¹è¿™ä¸ªè¯·æ±‚ç»è¿‡äº†ä¸¤æ¬¡çš„å¤„å¤„ç†
- ç¬¬äºŒå±‚çš„ä¸­é—´ä»¶åœ¨å¤„ç†å®Œè¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œåˆåˆ°äº†ç¬¬ä¸€å±‚çš„ä¸­é—´ä»¶, æ‰€ä»¥ç¬¬ä¸€å±‚çš„ä¸­é—´ä»¶ä¹Ÿå¯¹è¿™ä¸ªè¯·æ±‚ç»è¿‡äº†ä¸¤æ¬¡çš„å¤„ç†

è¿™ä¸ªè°ƒç”¨é¡ºåºå°±æ˜¯æ´‹è‘±æ¨¡å‹, ä¸­é—´ä»¶å¯¹è¯·æ±‚çš„å¤„ç†æœ‰ä¸€ç§å…ˆè¿›åå‡ºçš„æ„Ÿè§‰ï¼Œè¯·æ±‚æœ€å…ˆåˆ°è¾¾ç¬¬ä¸€å±‚ä¸­ é—´ä»¶ï¼Œè€Œæœ€åä¹Ÿæ˜¯ç¬¬ä¸€å±‚ä¸­é—´ä»¶å¯¹è¯·æ±‚å†æ¬¡å¤„ç†äº†ä¸€ä¸‹

#### 4.2.2 Koa2çš„å¿«é€Ÿä¸Šæ‰‹

##### 4.2.2.1 æ£€æŸ¥nodeç‰ˆæœ¬ï¼ŒKoa2çš„ä½¿ç”¨è¦æ±‚nodeç‰ˆæœ¬åœ¨7.6ä»¥ä¸Š

```bash
    node -v
```

##### 4.2.2.2 å®‰è£… Koa2

```bash
    npm init -y
    npm install koa
```

å¦‚æœä¸‹è½½ç‰¹åˆ«æ…¢ï¼Œå¯ä»¥å°†npmçš„ä¸‹è½½æºæ¢æˆå›½å†…çš„ä¸‹è½½æºï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```bash
    npm set registry https://registry.npm.taobao.org/
```

##### 4.2.2.3 ç¼–å†™å…¥å£æ–‡ä»¶app.js

- åˆ›å»ºKoaçš„å®ä¾‹å¯¹è±¡

```js
const Koa = require('koa') // å¯¼å…¥æ„é€ æ–¹æ³•
const app = new Koa() // é€šè¿‡æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå®ä¾‹å¯¹è±¡
```

- ç¼–å†™å“åº”å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰

  å“åº”å‡½æ•°æ˜¯é€šè¿‡useçš„æ–¹å¼æ‰èƒ½äº§ç”Ÿæ•ˆæœ, è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªæ˜¯ ctxï¼Œä¸€ä¸ªæ˜¯ next

  **ctx**ï¼šä¸Šä¸‹æ–‡, æŒ‡çš„æ˜¯è¯·æ±‚æ‰€å¤„äºçš„Webå®¹å™¨,æˆ‘ä»¬å¯ä»¥é€šè¿‡ ctx.request æ‹¿åˆ°è¯·æ±‚å¯¹è±¡, ä¹Ÿå¯ä»¥é€šè¿‡ ctx.response æ‹¿åˆ°å“åº”å¯¹è±¡

  **next**ï¼šå†…å±‚ä¸­é—´ä»¶æ‰§è¡Œçš„å…¥å£

```js
app.use((ctx, next) => {
  ctx.response.body = 'Hello Echarts'
})
```

- ç»‘å®šç«¯å£å·

```js
app.listen(9898)
```

- å¯åŠ¨æœåŠ¡å™¨

```bash
    node app.js
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://localhost:9898/ ä½ å°†ä¼šçœ‹åˆ°æµè§ˆå™¨ä¸­å‡ºç° Hello Echarts çš„å­—ç¬¦ä¸², å¹¶ä¸”åœ¨æœåŠ¡å™¨çš„ç»ˆç«¯ä¸­, ä¹Ÿèƒ½çœ‹åˆ°è¯·æ±‚çš„ url

#### 4.2.3 Koa2ä¸­é—´ä»¶çš„ç‰¹ç‚¹

- Koa2 çš„å®ä¾‹å¯¹è±¡é€šè¿‡ use æ–¹æ³•åŠ å…¥ä¸€ä¸ªä¸­é—´ä»¶
- ä¸€ä¸ªä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°,è¿™ä¸ªå‡½æ•°å…·å¤‡ä¸¤ä¸ªå‚æ•°,åˆ†åˆ«æ˜¯ ctx å’Œ next
- ä¸­é—´ä»¶çš„æ‰§è¡Œç¬¦åˆæ´‹è‘±æ¨¡å‹
- å†…å±‚ä¸­é—´ä»¶èƒ½å¦æ‰§è¡Œå–å†³äºå¤–å±‚ä¸­é—´ä»¶çš„ next å‡½æ•°æ˜¯å¦è°ƒç”¨
- è°ƒç”¨ next å‡½æ•°å¾—åˆ°çš„æ˜¯ Promise å¯¹è±¡, å¦‚æœæƒ³å¾—åˆ° Promise æ‰€åŒ…è£…çš„æ•°æ®, å¯ä»¥ç»“åˆ await å’Œ async

```js
app.use(async (ctx, next) => {
  // åˆšè¿›å…¥ä¸­é—´ä»¶æƒ³åšçš„äº‹æƒ…
  await next()
  // å†…å±‚æ‰€æœ‰ä¸­é—´ä»¶ç»“æŸä¹‹åæƒ³åšçš„äº‹æƒ…
})
```

#### 4.2.4 åç«¯é¡¹ç›®

##### 4.2.4.1 ç›®æ ‡

æˆ‘ä»¬å·²å­¦å®Œ Koa2 çš„å¿«é€Ÿä¸Šæ‰‹, å¹¶ä¸”å¯¹ Koa2 å½“ä¸­çš„ä¸­é—´ä»¶çš„ç‰¹ç‚¹è¿›è¡Œäº†äº†è§£. æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨Koa2 çš„çŸ¥è¯†æ¥è¿›è¡Œåå°é¡¹ç›®çš„å¼€å‘ï¼Œåå°é¡¹ç›®éœ€è¦è¾¾åˆ°ä»¥ä¸‹å‡ ä¸ªç›®æ ‡:

- è®¡ç®—æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ€»è€—æ—¶

  è®¡ç®—å‡ºæœåŠ¡å™¨å¯¹äºè¿™ä¸ªè¯·æ±‚å®ƒçš„æ‰€æœ‰ä¸­é—´ä»¶æ€»è€—æ—¶æ—¶é•¿ç©¶ç«Ÿæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸‹

- åœ¨å“åº”å¤´ä¸ŠåŠ ä¸Šå“åº”å†…å®¹çš„ mime ç±»å‹

  åŠ å…¥mimeç±»å‹, å¯ä»¥è®©æµè§ˆå™¨æ›´å¥½çš„æ¥å¤„ç†ç”±æœåŠ¡å™¨è¿”å›çš„æ•°æ®

  å¦‚æœå“åº”ç»™å‰ç«¯æµè§ˆå™¨æ˜¯ json æ ¼å¼çš„æ•°æ®ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ¨å’±ä»¬çš„å“åº”å¤´å½“ä¸­å¢åŠ  Content- Type å®ƒçš„å€¼å°±æ˜¯ application/json ï¼Œ application/json å°±æ˜¯ json æ•°æ®ç±»å‹çš„ mime ç±»å‹

- æ ¹æ®URLè¯»å–æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹

  ä¸ºäº†ç®€åŒ–åå°æœåŠ¡å™¨çš„ä»£ç ï¼Œå‰ç«¯å›¾è¡¨æ‰€è¦çš„æ•°æ®, å¹¶æ²¡æœ‰å­˜åœ¨æ•°æ®åº“å½“ä¸­ï¼Œè€Œæ˜¯å°†å­˜åœ¨æ–‡ä»¶å½“ä¸­ çš„ï¼Œè¿™ç§æ“ä½œåªæ˜¯ä¸ºäº†ç®€åŒ–å’±ä»¬åå°çš„ä»£ç . æ‰€ä»¥å’±ä»¬æ˜¯éœ€è¦å»è¯»å–æŸä¸€ä¸ªç›®å½•ä¸‹é¢çš„æ–‡ä»¶å†…å®¹ çš„ã€‚

æ¯ä¸€ä¸ªç›®æ ‡å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶éœ€è¦å®ç°çš„åŠŸèƒ½, æ‰€ä»¥åå°é¡¹ç›®ä¸­éœ€è¦æœ‰ä¸‰ä¸ªä¸­é—´ä»¶

##### 4.2.4.2 æ­¥éª¤

åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ koa-server , è¿™ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯åå°é¡¹ç›®çš„æ–‡ä»¶å¤¹

###### 4.2.4.2.1 é¡¹ç›®å‡†å¤‡

- å®‰è£…åŒ…

```bash
    npm init -y
    npm install koa
```

- åˆ›å»ºæ–‡ä»¶å’Œç›®å½•ç»“æ„

  app.js æ˜¯åå°æœåŠ¡å™¨çš„å…¥å£æ–‡ä»¶

  data ç›®å½•æ˜¯ç”¨æ¥å­˜æ”¾æ‰€æœ‰æ¨¡å—çš„ json æ–‡ä»¶æ•°æ®

  middleware æ˜¯ç”¨æ¥å­˜æ”¾æ‰€æœ‰çš„ä¸­é—´ä»¶ä»£ç 

  koa_response_data.js æ˜¯ä¸šåŠ¡é€»è¾‘ä¸­é—´ä»¶

  koa_response_duration.js æ˜¯è®¡ç®—æœåŠ¡å™¨å¤„ç†æ—¶é•¿çš„ä¸­é—´ä»¶

  koa_response_header.js æ˜¯ç”¨æ¥ä¸“é—¨è®¾ç½®å“åº”å¤´çš„ä¸­é—´ä»¶

æ¥ç€å°†å„ä¸ªæ¨¡å—çš„ json æ•°æ®æ–‡ä»¶å¤åˆ¶åˆ° data çš„ç›®å½•ä¹‹ä¸‹, æ¥ç€åœ¨ app.js æ–‡ä»¶ä¸­å†™ä¸Šä»£ç å¦‚ä¸‹ï¼š

```js
// æœåŠ¡å™¨çš„å…¥å£æ–‡ä»¶
// 1.åˆ›å»ºKOAçš„å®ä¾‹å¯¹è±¡
const Koa = require('koa')
const app = new Koa()
// 2.ç»‘å®šä¸­é—´ä»¶
// ç»‘å®šç¬¬ä¸€å±‚ä¸­é—´ä»¶
// ç»‘å®šç¬¬äºŒå±‚ä¸­é—´ä»¶
// ç»‘å®šç¬¬ä¸‰å±‚ä¸­é—´ä»¶
// 3.ç»‘å®šç«¯å£å· 9898
app.listen(9898)
```

###### 4.2.4.2.2 æ€»è€—æ—¶ä¸­é—´ä»¶

- ç¬¬1å±‚ä¸­é—´ä»¶

  æ€»è€—æ—¶ä¸­é—´ä»¶çš„åŠŸèƒ½å°±æ˜¯è®¡ç®—å‡ºæœåŠ¡å™¨æ‰€æœ‰ä¸­é—´ä»¶çš„æ€»è€—æ—¶ï¼Œåº”è¯¥ä½äºç¬¬ä¸€å±‚ï¼Œå› ä¸ºç¬¬ä¸€å±‚çš„ä¸­é—´ä»¶æ˜¯æœ€å…ˆå¤„ç†è¯·æ±‚çš„ä¸­é—´ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€åå¤„ç†è¯·æ±‚çš„ä¸­é—´ä»¶

- è®¡ç®—æ‰§è¡Œæ—¶é—´

  ç¬¬ä¸€æ¬¡è¿›å…¥å’±ä»¬ä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå°±è®°å½•ä¸€ä¸ªå¼€å§‹çš„æ—¶é—´ï¼Œå½“å…¶ä»–æ‰€æœ‰ä¸­é—´ä»¶éƒ½æ‰§è¡Œå®Œä¹‹åï¼Œå†è®°å½•ä¸‹ç»“æŸæ—¶é—´ä»¥åï¼Œå°†ä¸¤è€…ç›¸å‡å°±å¾—å‡ºæ€»è€—æ—¶

- è®¾ç½®å“åº”å¤´

  å°†è®¡ç®—å‡ºæ¥çš„ç»“æœ,è®¾ç½®åˆ°å“åº”å¤´çš„ X-Response-Time ä¸­, å•ä½æ˜¯æ¯«ç§’ ms

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```js
    // app.js æ–‡ä»¶
    // ç»‘å®šç¬¬ä¸€å±‚ä¸­é—´ä»¶
    const respDurationMiddleware = require('./middleware/koa_response_duration') app.use(respDurationMiddleware)


    // koa_response_duration.js æ–‡ä»¶
    // è®¡ç®—æœåŠ¡å™¨æ¶ˆè€—æ—¶é•¿çš„ä¸­é—´ä»¶
    module.exports = async (ctx, next) => {
    // è®°å½•å¼€å§‹æ—¶é—´
    const start = Date.now()
    // è®©å†…å±‚ä¸­é—´ä»¶å¾—åˆ°æ‰§è¡Œ
    await next()
    // è®°å½•ç»“æŸçš„æ—¶é—´
    const end = Date.now()
    // è®¾ç½®å“åº”å¤´ X-Response-Time
    const duration = end - start
    // ctx.set è®¾ç½®å“åº”å¤´
    ctx.set('X-Response-Time', duration + 'ms') }
```

###### 4.2.4.2.3 å“åº”å¤´ä¸­é—´ä»¶

- ç¬¬2å±‚ä¸­é—´ä»¶

  è¿™ä¸ªç¬¬2å±‚ä¸­é—´ä»¶æ²¡æœ‰ç‰¹å®šçš„è¦æ±‚

- è·å–mimeç±»å‹

  ç”±äºå’±ä»¬æ‰€å“åº”ç»™å‰ç«¯æµè§ˆå™¨å½“ä¸­çš„æ•°æ®éƒ½æ˜¯ json æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ mime ç±»å‹å¯ä»¥ç»Ÿä¸€çš„ç»™å®ƒå†™æˆ application/json , å½“ç„¶è¿™ä¸€å—ä¹Ÿæ˜¯ç®€åŒ–çš„å¤„ç†ï¼Œå› ä¸º mime ç±»å‹æœ‰å‡ åå‡ ç™¾ç§ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦åœ¨é¡¹ç›®å½“ä¸­è€ƒè™‘é‚£ä¹ˆå¤šï¼Œæ‰€ä»¥è¿™é‡Œç®€åŒ–å¤„ç†ä¸€ä¸‹

- è®¾ç½®å“åº”å¤´

  å“åº”å¤´çš„keyæ˜¯ Content-Type ï¼Œå®ƒçš„å€¼æ˜¯ application/json , é¡ºä¾¿åŠ ä¸Š charset=utf-8 å‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘è¿™éƒ¨åˆ†å“åº”çš„æ•°æ®ï¼Œå®ƒçš„ç±»å‹æ˜¯ application/json ï¼ŒåŒæ—¶å®ƒçš„ç¼–ç æ˜¯ utf- 8

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```js
// app.js æ–‡ä»¶
// ç»‘å®šç¬¬äºŒå±‚ä¸­é—´ä»¶ const respHeaderMiddleware = require('./middleware/koa_response_header')
app.use(respHeaderMiddleware)

// koa_response_header.js æ–‡ä»¶
// è®¾ç½®å“åº”å¤´çš„ä¸­é—´ä»¶
module.exports = async (ctx, next) => {
  const contentType = 'application/json; charset=utf-8'
  ctx.set('Content-Type', contentType)
  await next()
}
```

###### 4.2.4.2.4 ä¸šåŠ¡é€»è¾‘ä¸­é—´ä»¶

- ç¬¬3å±‚ä¸­é—´ä»¶

  è¿™ä¸ªç¬¬3å±‚ä¸­é—´ä»¶æ²¡æœ‰ç‰¹å®šçš„è¦æ±‚

- è¯»å–æ–‡ä»¶å†…å®¹

```js
// è·å– URL è¯·æ±‚è·¯å¾„
const url = ctx.request.url

// æ ¹æ®URLè¯·æ±‚è·¯å¾„,æ‹¼æ¥å‡ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„
let filePath = url.replace('/api', '')
filePath = '../data' + filePath + '.json'
filePath = path.join(__dirname, filePath)
```

è¿™ä¸ª filePath å°±æ˜¯éœ€è¦è¯»å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä½¿ç”¨ fs æ¨¡å—ä¸­çš„ readFile æ–¹æ³•è¿›è¡Œå®ç°

- è®¾ç½®å“åº”ä½“

```js
ctx.response.body
```

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```js
// app.js æ–‡ä»¶
// ç»‘å®šç¬¬ä¸‰å±‚ä¸­é—´ä»¶ const respDataMiddleware = require('./middleware/koa_response_data')
app.use(respDataMiddleware)

// koa_response_data.js æ–‡ä»¶
// å¤„ç†ä¸šåŠ¡é€»è¾‘çš„ä¸­é—´ä»¶,è¯»å–æŸä¸ªjsonæ–‡ä»¶çš„æ•°æ®
const path = require('path')
const fileUtils = require('../utils/file_utils')

module.exports = async (ctx, next) => {
  // æ ¹æ®url
  const url = ctx.request.url // /api/seller ../data/seller.json
  let filePath = url.replace('/api', '') // /seller
  filePath = '../data' + filePath + '.json' // ../data/seller.json
  filePath = path.join(__dirname, filePath)
  try {
    const ret = await fileUtils.getFileJsonData(filePath)
    ctx.response.body = ret
  } catch (error) {
    const errorMsg = {
      message: 'è¯»å–æ–‡ä»¶å†…å®¹å¤±è´¥, æ–‡ä»¶èµ„æºä¸å­˜åœ¨',
      status: 404,
    }
    ctx.response.body = JSON.stringify(errorMsg)
  }
  console.log(filePath)
  await next()
}

// file_utils.js æ–‡ä»¶
// è¯»å–æ–‡ä»¶çš„å·¥å…·æ–¹æ³•
const fs = require('fs')

module.exports.getFileJsonData = (filePath) => {
  // æ ¹æ®æ–‡ä»¶çš„è·¯å¾„, è¯»å–æ–‡ä»¶çš„å†…å®¹
  return new Promise((resolve, reject) => {
    fs.readFile(filePath, 'utf-8', (error, data) => {
      if (error) {
        // è¯»å–æ–‡ä»¶å¤±è´¥
        reject(error)
      } else {
        // è¯»å–æ–‡ä»¶æˆåŠŸ
        resolve(data)
      }
    })
  })
}
```

###### 4.2.4.2.5 å…è®¸è·¨åŸŸ

- è®¾ç½®å“åº”å¤´

```js
app.use(async (ctx, next) => {
  ctx.set('Access-Control-Allow-Origin', '*')
  ctx.set('Access-Control-Allow-Methods', 'OPTIONS, GET, PUT, POST, DELETE')
  await next()
})
```

### 4.3 å‰ç«¯éƒ¨åˆ†

#### 4.3.1 å‰ç«¯é¡¹ç›®çš„å‡†å¤‡

##### 4.3.1.1 vue-cli è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®

**vue-cli è„šæ‰‹æ¶å®‰è£…**

```bash
    npm install -g @vue/cli
```

**åˆ›å»ºå·¥ç¨‹é¡¹ç›®**

```bash
    vue create screen
```

æ‰‹åŠ¨é€‰æ‹©é…ç½®é¡¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5Izj.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5TQs.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5HLq.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCX5LwV.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCXISSJ.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCXIpl9.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCXICO1.png)

![Web3ç ”ä¹ ç¤¾](https://s1.ax1x.com/2023/07/25/pCXIiex.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b13.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b14.png)

å®‰è£…æˆåŠŸæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
    cd screen
    npm run serve
```

**åˆ é™¤æ— å…³ä»£ç **

- ä¿®æ”¹ App.vue ä¸­çš„ä»£ç ,å°†å¸ƒå±€å’Œæ ·å¼åˆ é™¤, å˜æˆå¦‚ä¸‹ä»£ç ï¼š

```vue
<template>
  <div id="app">
    <!-- è·¯ç”±å ä½ç¬¦ -->
    <router-view />
  </div>
</template>

<style lang="less"></style>
```

- åˆ é™¤ components/HelloWorld.vue è¿™ä¸ªæ–‡ä»¶
- åˆ é™¤ views/About.vue å’Œ views/Home.vue è¿™ä¸¤ä¸ªæ–‡ä»¶
- ä¿®æ”¹ router/index.js ä¸­çš„ä»£ç ,å»é™¤è·¯ç”±é…ç½®å’Œ Home ç»„ä»¶å¯¼å…¥çš„ä»£ç 

```vue
import Vue from 'vue' import VueRouter from 'vue-router' Vue.use(VueRouter) const routes = [ { path:
'/', redirect: '/screen' }, { path: '/screen', component: () => import('@/views/screenPage') } ]
const router = new VueRouter({ mode: 'history', base: process.env.BASE_URL, routes }) export default
router
```

##### 4.3.1.2 é¡¹ç›®åŸºæœ¬é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º vue.config.js æ–‡ä»¶ï¼Œæ–°å¢ä»¥ä¸‹ä»£ç ï¼š

```js
// ä½¿ç”¨vue-cliåˆ›å»ºå‡ºæ¥çš„vueå·¥ç¨‹, Webpackçš„é…ç½®æ˜¯è¢«éšè—èµ·æ¥äº†çš„
// å¦‚æœæƒ³è¦†ç›–Webpackä¸­çš„é»˜è®¤é…ç½®,éœ€è¦åœ¨é¡¹ç›®çš„æ ¹è·¯å¾„ä¸‹å¢åŠ vue.config.jsæ–‡ä»¶
module.exports = {
  devServer: {
    port: 8999, // ç«¯å£å·é…ç½®
    // open: true // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
  productionSourceMap: false, // ç”Ÿäº§ç¯å¢ƒæ˜¯å¦ç”Ÿæˆ sourceMap æ–‡ä»¶
  configureWebpack: (config) => {
    if (process.env.NODE_ENV === 'production') {
      // ä¸ºç”Ÿäº§ç¯å¢ƒä¿®æ”¹é…ç½®...
      config.mode = 'production'
      config['performance'] = {
        //æ‰“åŒ…æ–‡ä»¶å¤§å°é…ç½®
        maxEntrypointSize: 10000000,
        maxAssetSize: 30000000,
      }
    }
  },
}
```

##### 4.3.1.3 å…¨å±€echartså¯¹è±¡

- å¼•å…¥echartsæ–‡ä»¶

åœ¨public/index.htmlæ–‡ä»¶ä¸­å¼•å…¥å¤–éƒ¨CDNæ–‡ä»¶echarts.min.jsï¼Œå¦‚ä¸‹å›¾ï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b15.png)

- å…¨å±€echartsæŒ‚è½½åˆ°VueåŸå‹å¯¹è±¡ä¸Šå¹¶ä½¿ç”¨

åœ¨src/main.jsæ–‡ä»¶ä¸­æŒ‚è½½ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
// å°†å…¨å±€çš„echartså¯¹è±¡æŒ‚è½½åˆ°Vueçš„åŸå‹å¯¹è±¡ä¸Š
// åœ¨åˆ«çš„ç»„ä»¶ä¸­ä½¿ç”¨ this.$echarts
Vue.prototype.$echarts = window.echarts
```

##### 4.3.1.4 axiosçš„å¤„ç†

**å®‰è£…axiosåŒ…**

```bash
    npm install axios
```

**å°è£…ä¸ä½¿ç”¨axios**

åœ¨ src/main.js æ–‡ä»¶ä¸­é…ç½® axios å¹¶ä¸”æŒ‚è½½åˆ°Vueçš„åŸå‹å¯¹è±¡ä¸Šï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
// å°†axiosæŒ‚è½½åˆ°Vueçš„åŸå‹å¯¹è±¡ä¸Š
// åœ¨åˆ«çš„ç»„ä»¶ä¸­ä½¿ç”¨ this.$http
Vue.prototype.$http = axios
```

#### 4.3.2 å•ç‹¬å›¾è¡¨ç»„ä»¶å¼€å‘

æ¯ä¸ªå›¾è¡¨ä¼šå•ç‹¬è¿›è¡Œå¼€å‘ï¼Œæœ€åå†å°†æ‰€æœ‰çš„å›¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªé¡µé¢ä¸­ï¼Œåœ¨å•ç‹¬å¼€å‘æ¯ä¸ªå›¾è¡¨çš„æ—¶å€™ï¼Œä¸€ä¸ªå›¾è¡¨ä¼šç”¨ä¸€ä¸ªå•ç‹¬çš„è·¯å¾„è¿›è¡Œå…¨å±å±•ç¤ºï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š

- å•†å®¶é”€å”®ç»Ÿè®¡ http://localhost:8999/sellerPage
- é”€é‡è¶‹åŠ¿åˆ†æ http://localhost:8999/trendPage
- å•†å®¶åœ°å›¾åˆ†å¸ƒ http://localhost:8999/mapPage
- åœ°åŒºé”€é‡æ’è¡Œ http://localhost:8999/rankPage
- çƒ­é”€å•†å“å æ¯” http://localhost:8999/hotPage
- åº“å­˜é”€é‡åˆ†æ http://localhost:8999/stockPage

##### 4.3.2.1 å•†å®¶é”€é‡ç»Ÿè®¡

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b16.png)

**ç»„ä»¶ç»“æ„è®¾è®¡**

åœ¨ src/components/ ç›®å½•ä¸‹å»ºç«‹ Seller.vue , è¿™ä¸ªç»„ä»¶æ˜¯çœŸå®å±•ç¤ºå›¾è¡¨çš„ç»„ä»¶

- ç»™å¤–å±‚divå¢åŠ ç±»æ ·å¼ com-container
- å»ºç«‹ä¸€ä¸ªæ˜¾ç¤ºå›¾è¡¨çš„divå…ƒç´ 
- ç»™æ–°å¢çš„è¿™ä¸ªdivå¢åŠ ç±»æ ·å¼ com-chart

```vue
<template>
  <div class="com-container">
    <div class="com-chart" ref="seller_ref"></div>
  </div>
</template>

<script>
export default {
  data() {
    return {}
  },
  methods: {},
}
</script>

<style lang="less" scoped></style>
```

åœ¨ src/views/ ç›®å½•ä¸‹å»ºç«‹ sellerPage.vueï¼Œè¿™ä¸ªç»„ä»¶æ˜¯å¯¹åº”äºè·¯ç”± /seller è€Œå±•ç¤ºçš„

- ç»™å¤–å±‚divå…ƒç´ å¢åŠ æ ·å¼ com-page
- åœ¨ sellerPage ä¸­å¼•å…¥ Seller ç»„ä»¶ï¼Œå¹¶ä¸”æ³¨å†Œå’Œä½¿ç”¨

```vue
<template>
  <div class="com-page">
    <Seller />
  </div>
</template>

<script>
import Seller from '@/components/Seller'

export default {
  components: {
    Seller,
  },
  data() {
    return {}
  },
  methods: {},
}
</script>

<style lang="less" scoped></style>
```

å¢åŠ è·¯ç”±è§„åˆ™, åœ¨ src/router/index.js æ–‡ä»¶æ–°å¢å¦‚ä¸‹ä»£ç ï¼š

```js
const routes = [
  {
    path: '/sellerPage',
    component: () => import('@/views/sellerPage'),
  },
]
```

æ–°å»º src/assets/css/global.less å¢åŠ å®½é«˜æ ·å¼

åŸåˆ™å°±æ˜¯å°†æ‰€æœ‰çš„å®¹å™¨çš„å®½åº¦å’Œé«˜åº¦è®¾ç½®ä¸ºå æ»¡çˆ¶å®¹å™¨

```css
html,
body,
#app {
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
  overflow: hidden;
}

.com-page,
.com-container,
.com-chart {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

canvas {
  border-radius: 20px;
}

.com-container {
  position: relative;
}
```

åœ¨ main.js ä¸­å¼•å…¥æ ·å¼

```js
import './assets/css/global.less'
```

æ‰“å¼€æµè§ˆå™¨, è¾“å…¥ http://localhost:8999/sellerPage çœ‹Sellerç»„ä»¶æ˜¯å¦èƒ½å¤Ÿæ˜¾ç¤º

**å›¾è¡¨Seller.vueåŸºæœ¬åŠŸèƒ½å®ç°**

- åœ¨mountedç”Ÿå‘½å‘¨æœŸä¸­åˆå§‹åŒ– echartsInstance å¯¹è±¡
- åœ¨mountedä¸­è·å–æœåŠ¡å™¨çš„æ•°æ®
- å°†è·å–åˆ°çš„æ•°æ®è®¾ç½®åˆ°å›¾è¡¨ä¸Š

```vue
<script>
import { mapState } from 'vuex'
import { getThemeValue } from '@/utils/theme_utils'
export default {
  data() {
    return {
      myChart: null, // echartså®ä¾‹å¯¹è±¡
      allData: null, // æœåŠ¡å™¨è·å–çš„æ‰€æœ‰æ•°æ®
    }
  },
  mounted() {
    this.initChart()
    this.getData()
  },
  methods: {
    // åˆå§‹åŒ–echartsInstanceå¯¹è±¡
    initChart() {
      this.myChart = this.$echarts.init(this.$refs.seller_ref, this.theme)
    },
    // è·å–æœåŠ¡ç«¯çš„æ•°æ®
    async getData() {
      const { data: ret } = await this.$http.get('seller')
      // console.log("è·å–åç«¯æ•°æ®===", ret);
      this.allData = ret
      // å¯¹æ•°æ®æ’åº
      this.allData.sort((a, b) => {
        return a.value - b.value
      })
      this.updateChart()
    },
    // æ›´æ–°å›¾è¡¨
    updateChart() {
      const sellerName = showData.map((item) => {
        return item.name
      })

      const sellerValue = showData.map((item) => {
        return item.value
      })

      const dataOption = {
        xAxis: {
          type: 'value',
        },
        yAxis: {
          type: 'category',
          data: sellerName,
        },
        series: [
          {
            type: 'bar',
            data: sellerValue,
          },
        ],
      }

      this.myChart.setOption(dataOption)
    },
  },
}
</script>
```

æ‹†åˆ†é…ç½®é¡¹option

åˆå§‹åŒ–é…ç½®é¡¹

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b17.png)

æ‹¥æœ‰æ•°æ®ä¹‹åçš„é…ç½®é¡¹

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b18.png)

**åˆ†é¡µåŠ¨ç”»å®ç°**

- æ•°æ®çš„å¤„ç†, æ¯5ä¸ªå…ƒç´ æ˜¾ç¤ºä¸€é¡µ

æ•°æ®çš„å¤„ç†

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b19.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b20.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b21.png)

åŠ¨ç”»çš„å¯åŠ¨å’Œåœæ­¢

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b22.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b23.png)

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b24.png)

é¼ æ ‡äº‹ä»¶çš„å¤„ç†

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b25.png)

**UIæ•ˆæœè°ƒæ•´**

ä¸»é¢˜çš„æŒ‡å®šï¼Œåœ¨åˆå§‹åŒ–echartså®ä¾‹å¯¹è±¡çš„æ—¶å€™æŒ‡å®š

```vue
// src/components/Seller.vue methods: { initChart() { this.myChart =
this.$echarts.init(this.$refs.seller_ref, 'dark'); // å¯¹å›¾è¡¨å¯¹è±¡è¿›è¡Œé¼ æ ‡äº‹ä»¶çš„ç›‘å¬
this.myChart.on("mouseover", () => { clearInterval(this.timer); }); this.myChart.on("mouseout", ()
=> { this.startInterval(); }); } }
```

è¾¹æ¡†åœ†è§’è®¾ç½®

```css
//  src/assets/css/global.less
    canvas {
  border-radius: 20px;
}
```

å…¶ä»–å›¾æ ‡æ ·å¼é…ç½®

```js
    // æ ‡é¢˜çš„ä½ç½®å’Œé¢œè‰²
    const initOption = {
        title: {
          text: "â– å•†å®¶é”€å”®ç»Ÿè®¡",
          textStyle: {
            fontSize: 66,
          },
          left: 20,
          top: 20,
        }
    }

    // åæ ‡è½´çš„å¤§å°
    const initOption = {
        grid: {
          top: "20%",
          left: "3%",
          right: "6%",
          bottom: "3%",
          containLabel: true, // è·ç¦»åŒ…å«åæ ‡è½´ä¸Šçš„æ–‡å­—
        }
    }

    // å·¥å…·æç¤ºå’ŒèƒŒæ™¯
    const initOption = {
        tooltip: {
          trigger: "axis",
          axisPointer: {
            type: 'shadow'
          },
        }
    }

    // æ–‡å­—æ˜¾ç¤ºå’Œä½ç½®
    const initOption = {
      series: [
        label: {
          show: true,
          position: "right",
          textStyle: {
            color: '#fff',
          },
        }
      ]
    }

    // æŸ±å®½åº¦å’ŒæŸ±åœ†è§’çš„å®ç°
    const initOption = {
        series: [
          {
            barWidth: 66,
                itemStyle: {
                  barBorderRadius: [0, 33, 33, 0],
                },
            }
         ]
    }

    // æŸ±é¢œè‰²æ¸å˜çš„å®ç°ï¼Œçº¿æ€§æ¸å˜å¯ä»¥é€šè¿‡ LinearGradient è¿›è¡Œå®ç°
    // LinearGradient éœ€è¦ä¼ é€’5ä¸ªå‚æ•°, å‰å››ä¸ªä»£è¡¨ä¸¤ä¸ªç‚¹çš„ç›¸å¯¹ä½ç½®ï¼Œç¬¬äº”ä¸ªå‚æ•°ä»£è¡¨é¢œè‰²å˜åŒ–çš„èŒƒå›´
    // 0, 0, 1, 0 ä»£è¡¨çš„æ˜¯ä»å·¦å¾€å³çš„æ–¹å‘
    const initOption = {
        series: [
          {
                itemStyle: {
                  barBorderRadius: [0, 33, 33, 0],
                  // æŒ‡æ˜é¢œè‰²æ¸å˜çš„æ–¹å‘
                  // æŒ‡æ˜ä¸åŒç™¾åˆ†æ¯”ä¹‹ä¸‹é¢œè‰²çš„å€¼
                  color: {
                    type: "linear",
                    x: 0,
                    y: 0,
                    x2: 1,
                    y2: 0,
                    colorStops: [
                      {
                        offset: 0,
                        color: "#5052EE", // 0% å¤„çš„é¢œè‰²
                      },
                      {
                        offset: 1,
                        color: "#AB6EE5", // 100% å¤„çš„é¢œè‰²
                      },
                    ],
                    global: false, // ç¼ºçœä¸º false
                  },
                },
            }
         ]
    }
```

**åˆ†è¾¨ç‡é€‚é…**

- å¯¹çª—å£å¤§å°å˜åŒ–çš„äº‹ä»¶è¿›è¡Œç›‘å¬

```vue
mounted() { window.addEventListener("resize", this.screenAdapter); } destroyed() { //
åœ¨ç»„ä»¶é”€æ¯æ—¶ï¼Œéœ€å°†ç›‘å¬å™¨æ³¨é”€ window.removeEventListener("resize", this.screenAdapter); },
```

- è·å–å›¾è¡¨å®¹å™¨çš„å®½åº¦è®¡ç®—å­—ä½“å¤§å°

```vue
// å½“æµè§ˆå™¨çš„å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œæ¥å®Œæˆå±å¹•çš„é€‚é… methods: { screenAdapter() { const
titleFontSize = (this.$refs.seller_ref.offsetWidth / 100) * 3.6; } }
```

- å°†å­—ä½“å¤§å°çš„å€¼è®¾ç½®ç»™å›¾è¡¨çš„æŸäº›åŒºåŸŸ

```vue
// æ ‡é¢˜å¤§å°ã€èƒŒæ™¯å¤§å°ã€æŸ±å®½åº¦ã€åœ†è§’å¤§å° methods: { screenAdapter() { const titleFontSize =
(this.$refs.seller_ref.offsetWidth / 100) * 3.6; const adapterOption = { title: { textStyle: {
fontSize: titleFontSize, }, }, tooltip: { axisPointer: { lineStyle: { width: titleFontSize, }, }, },
series: [ { barWidth: titleFontSize, itemStyle: { borderRadius: [0, titleFontSize / 2, titleFontSize
/ 2, 0], }, }, ], }; this.myChart.setOption(adapterOption); // æ‰‹åŠ¨è°ƒç”¨å›¾è¡¨å¯¹è±¡çš„resizeæ‰èƒ½ç”Ÿæ•ˆ
this.myChart.resize(); } }
```

##### 4.3.2.2 é”€é‡è¶‹åŠ¿åˆ†æ

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b26.png)

- ä»£ç ç¯å¢ƒå‡†å¤‡

```vue
// trendPage.vue // é’ˆå¯¹äº /trendPage è¿™æ¡è·¯å¾„è€Œæ˜¾ç¤ºå‡ºæ¥çš„ åœ¨è¿™ä¸ªç»„ä»¶ä¸­, é€šè¿‡å­ç»„ä»¶æ³¨å†Œçš„æ–¹å¼,
è¦æ˜¾ç¤ºå‡ºTrend.vueè¿™ä¸ªç»„ä»¶
<template>
  <div class="com-page">
    <Trend />
  </div>
</template>

<script>
import Trend from '@/components/Trend'

export default {
  components: {
    Trend,
  },
  data() {
    return {}
  },
  methods: {},
}
</script>

<style lang="less" scoped></style>

// Trend.vue
<template>
  <div class="com-container">
    <div class="com-chart" ref="trend_ref"></div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      myChart: null,
      allData: null,
    }
  },
  created() {},
  mounted() {
    this.initChart()
    this.getData()
    window.addEventListener('resize', this.screenAdapter)
    this.screenAdapter()
  },
  destroyed() {
    window.removeEventListener('resize', this.screenAdapter)
  },
  methods: {
    initChart() {
      this.myChart = this.$echarts.init(this.$refs.trend_ref, 'dark')
      const initOption = {}
      this.myChart.setOption(initOption)
    },
    async getData() {
      const { data: ret } = await this.$http.get('trend')
      this.allData = ret
      this.updateChart()
    },
    updateChart() {
      const dataOption = {}
      this.myChart.setOption(dataOption)
    },
    screenAdapter() {
      const adapterOption = {}
      this.myChart.setOption(adapterOption)
      this.myChart.resize()
    },
  },
}
</script>

<style lang="less" scoped></style>

// router/index.js const routes = [ { path: '/trendPage', component: () =>
import('@/views/trendPage') } ]
```

- å›¾è¡¨åŸºæœ¬åŠŸèƒ½çš„å®ç°

æ•°æ®çš„è·å–

```js
    // è·å–æœåŠ¡å™¨çš„æ•°æ®, å¯¹this.allDataè¿›è¡Œèµ‹å€¼ä¹‹å, è°ƒç”¨updateChartæ–¹æ³•æ›´æ–°å›¾è¡¨
    async getData() {
      const { data: ret } = await this.$http.get("trend");
      this.allData = ret;
      this.updateChart();
    }
```

æ•°æ®çš„å¤„ç†

```js
    updateChart() {
      // ç±»ç›®è½´æ•°æ®
      const timeArr = this.allData.common.month;
      // yè½´æ•°æ® seriesä¸‹çš„æ•°æ®
      // mapä»£è¡¨åœ°åŒºé”€é‡è¶‹åŠ¿
      // sellerä»£è¡¨å•†å®¶é”€é‡è¶‹åŠ¿
      // commodityä»£è¡¨å•†å“é”€é‡è¶‹åŠ¿
      const valueArr = this.allData.map.data;
      // å›¾è¡¨æ•°æ®, ä¸€ä¸ªå›¾è¡¨ä¸­æ˜¾ç¤º5æ¡æŠ˜çº¿å›¾
      const seriesArr = valueArr.map((item, index) => {
        return {
          name: item.name,
          type: "line",
          data: item.data,
          smooth: true,
          stack: 'map' // stackå€¼ç›¸åŒ, å¯ä»¥å½¢æˆå †å å›¾æ•ˆæœ
        };
      });
      // å›¾ä¾‹æ•°æ®
      const legendArr = valueArr.map((item) => {
        return item.name;
      });
      const dataOption = {
        xAxis: {
          data: timeArr,
        },
        legend: {
          data: legendArr,
        },
        series: seriesArr,
      };
      this.myChart.setOption(dataOption);
    }
```

åˆå§‹åŒ–é…ç½®

```js
const initOption = {
  xAxis: {
    type: 'category',
    boundaryGap: false,
  },
  yAxis: {
    type: 'value',
  },
}
```

- UIæ•ˆæœè°ƒæ•´

ä¸»é¢˜çš„ä½¿ç”¨

```js
    initChart() {
      this.myChart = this.$echarts.init(this.$refs.trend_ref, 'dark');
    }
```

åæ ‡è½´å¤§å°å’Œä½ç½®ï¼Œå·¥å…·æç¤ºï¼Œå›¾ä¾‹ä½ç½®å’Œå½¢çŠ¶

```js
const initOption = {
  // åæ ‡è½´å¤§å°å’Œä½ç½®
  grid: {
    left: '3%',
    top: '30%',
    right: '4%',
    bottom: '1%',
    containLabel: true,
  },
  // å·¥å…·æç¤º
  tooltip: {
    trigger: 'axis',
  },
  // å›¾ä¾‹ä½ç½®å’Œå½¢çŠ¶
  legend: {
    left: 20,
    top: '15%',
    icon: 'circle',
  },
}
```

åŒºåŸŸé¢ç§¯å’Œé¢œè‰²æ¸å˜çš„è®¾ç½®

```js
    updateChart() {
          // åŠé€æ˜é¢œè‰²å€¼
          const colorArr1 = [
            "rgba(73, 146, 255, .5)",
            "rgba(124, 255, 178, .5)",
            "rgba(253, 221, 96, .5)",
            "rgba(255, 110, 118, .5)",
            "rgba(88, 217, 249, .5)",
          ];
          // å…¨é€æ˜é¢œè‰²å€¼
          const colorArr2 = [
            "rgba(73, 146, 255, 0)",
            "rgba(124, 255, 178, 0)",
            "rgba(253, 221, 96, 0)",
            "rgba(255, 110, 118, 0)",
            "rgba(88, 217, 249, 0)",
          ];
          const seriesArr = valueArr.map((item, index) => {
            return {
              // åŒºåŸŸé¢ç§¯åªéœ€è¦ç»™seriesçš„æ¯ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€ä¸ª areaStyle å³å¯
              areaStyle: {
                // é¢œè‰²æ¸å˜å¯ä»¥é€šè¿‡ LinearGradient è¿›è¡Œè®¾ç½®, é¢œè‰²æ¸å˜çš„æ–¹å‘ä»ä¸Šå¾€ä¸‹
                color: new this.$echarts.graphic.LinearGradient(0, 0, 0, 1, [
                  {
                    offset: 0,
                    color: colorArr1[index],
                  },
                  {
                    offset: 1,
                    color: colorArr2[index],
                  },
                ]),
              },
            };
          });
        }
```

- åˆ‡æ¢å›¾è¡¨
- åˆ†è¾¨ç‡é€‚é…

åˆ†è¾¨ç‡é€‚é…ä¸»è¦å°±æ˜¯åœ¨ screenAdapter æ–¹æ³•ä¸­è¿›è¡Œ, éœ€è¦è·å–å›¾è¡¨å®¹å™¨çš„å®½åº¦ï¼Œè®¡ç®—å‡ºæ ‡é¢˜å­—ä½“å¤§å°ï¼Œå°†å­—ä½“çš„å¤§å°èµ‹å€¼ç»™ titleFontSize

```vue
<script>
export default {
  data() {
    return {
      titleFontSize: 0,
    }
  },
  methods: {
    screenAdapter() {
      this.titleFontSize = (this.$refs.trend_ref.offsetWidth / 100) * 3.6
    },
  },
}
</script>
```

é€šè¿‡ titleFontSize å»è®¾ç½®ç»™æ ‡é¢˜æ–‡å­—çš„å¤§å°å’Œå›¾ä¾‹çš„å¤§å°

æ ‡é¢˜æ–‡å­—çš„å¤§å°ï¼Œå¢åŠ è®¡ç®—å±æ€§comStyleå¹¶è®¾ç½®ç»™å¯¹åº”çš„divï¼Œä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <div class="com-container">
    <div class="title" :style="comStyle">
      <span>{{ 'â– ' + showTitle }}</span>
      <span
        class="iconfont icon-arrow-down title-icon"
        :style="comStyle"
        @click="showChoice = !showChoice"
      ></span>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      titleFontSize: 0,
    }
  },
  computed: {
    // è®¾ç½®ç»™æ ‡é¢˜çš„æ ·å¼
    comStyle() {
      return {
        fontSize: this.titleFontSize + 'px',
      }
    },
  },
}
</script>
```

å›¾ä¾‹çš„å¤§å°

```vue
methods: { screenAdapter() { this.titleFontSize = (this.$refs.trend_ref.offsetWidth / 100) * 3.6;
const adapterOption = { legend: { itemWidth: this.titleFontSize, itemHeight: this.titleFontSize,
itemGap: this.titleFontSize, textStyle: { fontSize: this.titleFontSize / 2, }, }, };
this.myChart.setOption(adapterOption); this.myChart.resize(); } }
```

##### 4.3.2.3 å•†å®¶åœ°å›¾åˆ†å¸ƒ

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b27.png)

> å¦‚éœ€è·å–æ›´å¤šèµ„æ–™åŠæ€ç»´å¯¼å›¾ï¼Œå¯ä»¥å…³æ³¨ä½œè€…å…¬ä¼—å·ã€Šæ‡’äººç å†œã€‹ï¼Œåå°å›å¤å…³é”®è¯â€œå¤§å±â€å³å¯è·å–

æŸ¥çœ‹å®Œæ•´æºä»£ç ï¼Œè¯·ç§»æ­¥åˆ°githubè®¿é—®ğŸ‘‰ï¼š[https://github.com/jackchen0120/EC-Platform-Monitor](https://github.com/jackchen0120/EC-Platform-Monitor)

##### 4.3.2.4 åœ°åŒºé”€é‡æ’è¡Œ

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b28.png)

##### 4.3.2.5 çƒ­é”€å•†å“å æ¯”

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b29.png)

##### 4.3.2.6 åº“å­˜é”€é‡åˆ†æ

æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Web3ç ”ä¹ ç¤¾](https://s1.imagehub.cc/images/2023/07/25/b30.png)

#### 4.3.3 WebScoketçš„ä½¿ç”¨

##### 4.3.3.1 åç«¯ä»£ç 

**å®‰è£…WebSocketåŒ…**

```bash
    npm install ws -S
```

**åˆ›å»º service\\web_socket_service.js æ–‡ä»¶**

- åˆ›å»ºWebSocketå®ä¾‹å¯¹è±¡

```js
const WebSocket = require('ws')
// åˆ›å»ºwebsocketæœåŠ¡ç«¯çš„å¯¹è±¡ï¼Œç»‘å®šç«¯å£å·ä¸º9998
const wss = new WebSocket.Server({
  port: 9998,
})
```

- ç›‘å¬äº‹ä»¶

```js
wss.on('connection', (client) => {
  console.log('æœ‰å®¢æˆ·ç«¯è¿æ¥...')
  client.on('message', (msg) => {
    console.log('å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥äº†')
    // å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯
    client.send('hello socket')
  })
})
```

- åœ¨app.jsä¸­å¼•å…¥web_scoket_service.jsè¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶è°ƒç”¨listenæ–¹æ³•

```js
const webSocketService = require('./service/web_socket_service')
// å¼€å¯æœåŠ¡ç«¯çš„ç›‘å¬ï¼Œç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥
// å½“æŸä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æˆåŠŸä¹‹åï¼Œå°±ä¼šå¯¹è¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œmessageäº‹ä»¶çš„ç›‘å¬
webSocketService.listen()
```

- çº¦å®šå¥½å–å®¢æˆ·ç«¯ä¹‹å‰æ•°æ®äº¤äº’çš„æ ¼å¼å’Œå«ä¹‰

å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„æ•°æ®äº¤äº’é‡‡ç”¨ JSON æ ¼å¼

å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡ç«¯çš„å­—æ®µå¦‚ä¸‹ï¼š

```js
    {
      "action": "getData",
      "socketType": "trendData",
      "chartName": "trend",
      "value": ""
    }
    // æˆ–è€…
    {
      "action": "fullScreen",
      "socketType": "fullScreen",
      "chartName": "trend",
      "value": true
    }
    // æˆ–è€…
    {
      "action": "themeChange",
      "socketType": "themeChange",
      "chartName": "",
      "value": "dark"
    }
```

**action : ä»£è¡¨æŸé¡¹è¡Œä¸º,å¯é€‰å€¼æœ‰**

- getData ä»£è¡¨è·å–å›¾è¡¨æ•°æ®
- fullScreen ä»£è¡¨äº§ç”Ÿäº†å…¨å±äº‹ä»¶
- themeChange ä»£è¡¨äº§ç”Ÿäº†ä¸»é¢˜åˆ‡æ¢çš„äº‹ä»¶

**socketType : ä»£è¡¨ä¸šåŠ¡æ¨¡å—ç±»å‹, è¿™ä¸ªå€¼ä»£è¡¨å‰ç«¯æ³¨å†Œæ•°æ®å›è°ƒå‡½æ•°çš„æ ‡è¯†, å¯é€‰å€¼æœ‰:**

- trendData
- sellerData
- mapData
- rankData
- hotData
- stockData
- fullScreen
- themeChange

**chartName : ä»£è¡¨å›¾è¡¨åç§°, å¦‚æœæ˜¯ä¸»é¢˜åˆ‡æ¢äº‹ä»¶, å¯ä¸ä¼ æ­¤å€¼, å¯é€‰å€¼æœ‰:**

- trend
- seller
- map
- rank
- hot
- stock

**value : ä»£è¡¨ å…·ä½“çš„æ•°æ®å€¼, åœ¨è·å–å›¾è¡¨æ•°æ®æ—¶, å¯ä¸ä¼ æ­¤å€¼, å¯é€‰å€¼æœ‰**

- å¦‚æœæ˜¯å…¨å±äº‹ä»¶, true ä»£è¡¨å…¨å±, false ä»£è¡¨éå…¨å±
- å¦‚æœæ˜¯ä¸»é¢˜åˆ‡æ¢äº‹ä»¶, å¯é€‰å€¼æœ‰ chalk æˆ–è€… vintage

**æœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®å¦‚ä¸‹:**

```js
    {
        "action": "getData",
        "socketType": "trendData",
        "chartName": "trend",
        "value": "",
        "data": "ä»æ–‡ä»¶è¯»å–å‡ºæ¥çš„jsonæ–‡ä»¶çš„å†…å®¹"
    }
    // æˆ–è€…
    {
        "action": "fullScreen",
        "socketType": "fullScreen",
        "chartName": "trend",
        "value": true
    }
    // æˆ–è€…
     {
        "action": "themeChange",
        "socketType": "themeChange",
        "chartName": "",
        "value": "dark"
    }
```

æ³¨æ„, é™¤äº† action ä¸º getData æ—¶, æœåŠ¡å™¨ä¼šåœ¨å®¢æˆ·ç«¯å‘è¿‡æ¥æ•°æ®çš„åŸºç¡€ä¹‹ä¸Š, å¢åŠ  data å­—æ®µï¼Œå…¶ä»–çš„æƒ…å†µ, æœåŠ¡å™¨ä¼šåŸå°ä¸åŠ¨çš„å°†ä»æŸä¸€ä¸ªå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ•°æ®è½¬å‘ç»™æ¯ä¸€ä¸ªå¤„äºè¿æ¥çŠ¶æ€ çš„å®¢æˆ·ç«¯

- ä»£ç å®ç°

```js
const path = require('path')
const fileUtils = require('../utils/file_utils')
const WebSocket = require('ws')
// åˆ›å»ºwebsocketæœåŠ¡ç«¯çš„å¯¹è±¡ï¼Œç»‘å®šç«¯å£å·ä¸º9998
const wss = new WebSocket.Server({
  port: 9998,
})

module.exports.listen = () => {
  // å¯¹å®¢æˆ·ç«¯çš„è¿æ¥äº‹ä»¶è¿›è¡Œç›‘å¬
  // clientä»£è¡¨æ˜¯å®¢æˆ·ç«¯çš„è¿æ¥socketå¯¹è±¡
  wss.on('connection', (client) => {
    console.log('æœ‰å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ...')
    // å¯¹å®¢æˆ·ç«¯çš„è¿æ¥å¯¹è±¡è¿›è¡Œmessageäº‹ä»¶çš„ç›‘å¬
    // msgç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®
    client.on('message', async (msg) => {
      console.log('å®¢æˆ·ç«¯å‘é€æ•°æ®ç»™æœåŠ¡ç«¯===', msg)
      let payload = JSON.parse(msg)
      const action = payload.action
      if (action === 'getData') {
        let filePath = '../data/' + payload.chartName + '.json'
        // trend seller map rank hot stock
        // payload.chartName
        filePath = path.join(__dirname, filePath)
        const ret = await fileUtils.getFileJsonData(filePath)
        // éœ€è¦åœ¨æœåŠ¡ç«¯è·å–åˆ°æ•°æ®çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¢åŠ ä¸€ä¸ªdataçš„å­—æ®µ
        // dataæ‰€å¯¹åº”çš„å€¼ï¼Œå°±æ˜¯æŸä¸ªjsonæ–‡ä»¶çš„å†…å®¹
        payload.data = ret
        client.send(JSON.stringify(payload))
      } else {
        // åŸå°ä¸åŠ¨çš„å°†æ‰€æ¥æ”¶åˆ°çš„æ•°æ®è½¬å‘ç»™æ¯ä¸€ä¸ªå¤„äºè¿æ¥çŠ¶æ€çš„å®¢æˆ·ç«¯
        // wss.clients æ‰€æœ‰å®¢æˆ·ç«¯çš„è¿æ¥
        wss.clients.forEach((client) => {
          client.send(msg)
        })
      }
      // æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®
      // client.send('hello socket form backend');
    })
  })
}
```

##### 4.3.3.2 å‰ç«¯ä»£ç 

- å®šä¹‰å•ä¾‹ï¼Œåˆ›å»ºWebSocketå®ä¾‹å¯¹è±¡

åˆ›å»ºscr/utils/socket_service.jsæ–‡ä»¶ï¼Œå®šä¹‰å•ä¾‹ä»£ç å¦‚ä¸‹ï¼š

```js
export default class SocketService {
  // å•ä¾‹æ¨¡å¼

  static instance = null
  static get Instance() {
    if (!this.instance) {
      this.instance = new SocketService()
    }
    return this.instance
  }
}
```

- ç›‘å¬WebSocketäº‹ä»¶

å®šä¹‰connectå‡½æ•°ï¼Œå°†åˆ›å»ºçš„WebSocketèµ‹å€¼ç»™å®ä¾‹å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
    // å®ä¾‹å±æ€§wså’ŒæœåŠ¡ç«¯è¿æ¥çš„socketå¯¹è±¡
    ws = null;

    // å®šä¹‰è¿æ¥æœåŠ¡å™¨çš„æ–¹æ³•
    connect () {
        // è¿æ¥æœåŠ¡å™¨
        if (!window.WebSocket) {
          return console.log('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒwebsocket');
        }
        this.ws = new WebSocket(`ws://106.55.168.13:9998/ws/webSocket`);
    }
```

ç›‘å¬äº‹ä»¶

```js
    connect() {
      if (!window.WebSocket) {
        return console.log('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ WebSocket!')
      }
      this.ws = new WebSocket('ws://localhost:9998')
      // ç›‘å¬è¿æ¥æˆåŠŸ
      this.ws.onopen = () => {
        console.log('WebSocket è¿æ¥æˆåŠŸ')
      }
      // æœåŠ¡å™¨è¿æ¥ä¸æˆåŠŸï¼ŒæœåŠ¡å™¨å…³é—­äº†è¿æ¥
      this.ws.onclose = e => {
        console.log('æœåŠ¡å™¨å…³é—­äº†è¿æ¥')
      }
      // ç›‘å¬æ¥æ”¶æ¶ˆæ¯
      this.ws.onmessage = msg => {
        console.log('WebSocket æ¥æ”¶åˆ°æ•°æ®')
      }
    }
```

å®šä¹‰æ³¨å†Œå‡½æ•°

```js
export default class SocketService {
  // ä¸šåŠ¡ç±»å‹å’Œå›è°ƒå‡½æ•°çš„å¯¹äºå…³ç³»
  callBackMapping = {}
  /*** socketType
   * trendData sellerData mapData rankData hotData stockData
   * fullScreen
   * themeChange
   * callBack
   * å›è°ƒå‡½æ•°
   */
  registerCallBack(socketType, callBack) {
    // å¾€ callBackMapä¸­å­˜æ”¾å›è°ƒå‡½æ•°
    this.callBackMapping[socketType] = callBack
  }
  unRegisterCallBack(socketType) {
    this.callBackMapping[socketType] = null
  }
}
```

è¿æ¥æœåŠ¡ç«¯

```js
    // åœ¨ main.js ä¸­è¿æ¥æœåŠ¡å™¨ç«¯
    import SocketService from '@/utils/socket_service' SocketService.Instance.connect()

    // å°† SocketService å®ä¾‹å¯¹è±¡æŒ‚è½½åˆ° Vue çš„åŸå‹å¯¹è±¡ä¸Š
    Vue.prototype.$socket = SocketService.Instance
```

å‘é€æ•°æ®ç»™æœåŠ¡ç«¯

åœ¨ socket_service.js ä¸­å®šä¹‰å‘é€æ•°æ®çš„æ–¹æ³•

```js
export default class SocketService {
  send(data) {
    console.log('å‘é€æ•°æ®ç»™æœåŠ¡å™¨:')
    this.ws.send(JSON.stringify(data))
  }
}
```

å…ˆä¿®æ”¹ Trend.vue æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```vue
mounted() { // å½“socketæ¥æ•°æ®çš„æ—¶å€™, ä¼šè°ƒç”¨getDataè¿™ä¸ªå‡½æ•°
this.$socket.registerCallBack('trendData', this.getData) // å¾€ socket å‘é€æ•°æ®,
ç›®çš„æ˜¯æƒ³è®©æœåŠ¡ç«¯ä¼ è¾“é”€é‡è¶‹åŠ¿è¿™ä¸ªæ¨¡å—çš„æ•°æ® this.initChart(); // this.getData(); //
å‘é€æ•°æ®ç»™æœåŠ¡ç«¯ï¼Œå‘Šè¯‰æœåŠ¡ç«¯ï¼Œå‰ç«¯ç°åœ¨éœ€è¦æ•°æ® this.$socket.send({ action: "getData", socketType:
"trendData", chartName: "trend", value: "" }) } // actionçš„å€¼ä¸å˜ï¼Œéƒ½æ˜¯getData //
socketTypeçš„å¯é€‰å€¼æœ‰ï¼štrendData,sellerData,mapData,rankData,hotData,stockData //
chartNameçš„å¯é€‰å€¼æœ‰: trend,seller,map,rank,hot,stock destroyed () {
this.$socket.unRegisterCallBack('trendData') }
```

è¿è¡Œä»£ç , å‘ç°æ•°æ®å‘ä¸å‡ºå»

å› ä¸ºåœ¨åˆ·æ–°ç•Œé¢ä¹‹å, å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿æ¥å¹¶ä¸ä¼šç«‹é©¬è¿æ¥æˆåŠŸ, åœ¨å¤„äºè¿æ¥çŠ¶æ€ä¸‹å°±è°ƒç”¨ send æ˜¯å‘é€ä¸æˆåŠŸçš„, å› æ­¤éœ€è¦ä¿®æ”¹ service_socket.js ä¸­çš„ send æ–¹æ³•è¿›è¡Œå®¹é”™å¤„ç†

```js
    // æ ‡è¯†æ˜¯å¦è¿æ¥æˆåŠŸ
    connected = false;

    // è®°å½•é‡è¯•çš„æ¬¡æ•°
    sendRetryCount = 0;

    // å‘é€æ•°æ®çš„æ–¹æ³•
    send (data) {
        // åˆ¤æ–­ç°åœ¨æ˜¯å¦æœ‰è¿æ¥æˆåŠŸ
        if (this.connected) {
          this.sendRetryCount = 0;
          this.ws.send(JSON.stringify(data));
        } else {
          this.sendRetryCount++;
          setTimeout(() => {
            this.send(data);
          }, this.sendRetryCount * 500)
        }
    }
```

åœ¨ onopen æ—¶è®¾ç½® connected çš„å€¼

```js
    // å®šä¹‰è¿æ¥æœåŠ¡å™¨çš„æ–¹æ³•
    connect () {
        // è¿æ¥æˆåŠŸçš„äº‹ä»¶
        this.ws.onopen = () => {
          console.log('è¿æ¥æœåŠ¡ç«¯æˆåŠŸ');
          this.connected = true;
          this.connectRetryCount = 0;
        }
    }
```

åœ¨ socket_service.js ä¸­ä¿®æ”¹æ¥æ”¶åˆ°æ¶ˆæ¯çš„ä»£ç å¤„ç†

```js
    // å®šä¹‰è¿æ¥æœåŠ¡å™¨çš„æ–¹æ³•
    connect () {
        // å¾—åˆ°æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®
        this.ws.onmessage = msg => {
          // console.log('ä»æœåŠ¡ç«¯è·å–åˆ°çš„æ•°æ®===', msg);
          // çœŸæ­£æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„åŸå§‹æ•°æ®æ—¶åœ¨msgä¸­çš„dataå­—æ®µ
          const recvData = JSON.parse(msg.data);
          const socketType = recvData.socketType;
          // åˆ¤æ–­å›è°ƒå‡½æ•°æ˜¯å¦å­˜åœ¨
          if (this.callBackMapping[socketType]) {
            const action = recvData.action
            if (action === 'getData') {
              const realData = JSON.parse(recvData.data);
              this.callBackMapping[socketType].call(this, realData);
            } else if (action === 'fullScreen') {
              this.callBackMapping[socketType].call(this, recvData);
            } else if (action === 'themeChange') {
              this.callBackMapping[socketType].call(this, recvData);
            }
          }
        }
    }
```

æ–­å¼€é‡è¿æœºåˆ¶

å¦‚æœåˆå§‹åŒ–è¿æ¥æœåŠ¡ç«¯ä¸æˆåŠŸ, æˆ–è€…è¿æ¥æˆåŠŸäº†, åæ¥æœåŠ¡å™¨å…³é—­äº†, è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šè§¦å‘ onclose äº‹ä»¶,æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªäº‹ä»¶ä¸­,è¿›è¡Œé‡è¿

```js
    connect() {
        // ç›‘å¬è¿æ¥æˆåŠŸ
        this.ws.onopen = () => {
          // è¿æ¥æˆåŠŸä¹‹å, é‡ç½®é‡è¿æ¬¡æ•°
          this.connectRetryCount = 0;
        }
        // è¿æ¥æœåŠ¡ç«¯å¤±è´¥
        // å½“è¿æ¥æˆåŠŸä¹‹åï¼ŒæœåŠ¡ç«¯å…³é—­çš„æƒ…å†µ
        this.ws.onclose = () => {
          console.log('è¿æ¥æœåŠ¡ç«¯å¤±è´¥');
          this.connected = false;
          this.connectRetryCount++;
          setTimeout(() => {
            this.connect();
          }, this.connectRetryCount * 500)
        }
    }
```

#### 4.3.4 ç»„ä»¶åˆå¹¶

- åˆ›å»ºscreenPage.vueæ–‡ä»¶ï¼Œå¹¶é…ç½®è·¯ç”±è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹ï¼š

```vue
// router/index.js import Vue from 'vue' import VueRouter from 'vue-router' Vue.use(VueRouter) const
routes = [ { path: '/', redirect: '/screen' }, { path: '/screen', component: () =>
import('@/views/screenPage') } ]
```

- ä»£ç å®ç°

é™æ€å›¾ç‰‡èµ„æºæ”¾åœ¨public/static/imgç›®å½•ä¹‹ä¸‹ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```vue
// screenPage.vue
<template>
  <div class="screen-container" :style="containerStyle">
    <header class="screen-header">
      <div>
        <img :src="headerSrc" alt="" />
      </div>
      <span class="logo">
        <img :src="logoSrc" alt="" />
      </span>
      <span class="title">ç”µå•†å¹³å°æ•°æ®å¤§å±å®æ—¶ç›‘æ§ç³»ç»Ÿ</span>
      <div class="title-right">
        <img :src="themeSrc" class="qiehuan" @click="handleChangeTheme" />
        <span class="datetime">{{ timeValue }}</span>
      </div>
    </header>
    <div class="screen-body">
      <section class="screen-left">
        <div id="left-top" :class="[fullScreenStatus.trend ? 'fullscreen' : '']">
          <!-- é”€é‡è¶‹åŠ¿å›¾è¡¨ -->
          <Trend ref="trend" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('trend')"
              :class="[
                'iconfont',
                fullScreenStatus.trend ? 'icon-compress-alt' : 'icon-expand-alt',
              ]"
            ></span>
          </div>
        </div>
        <div id="left-bottom" :class="[fullScreenStatus.seller ? 'fullscreen' : '']">
          <!-- å•†å®¶é”€å”®é‡‘é¢å›¾è¡¨ -->
          <Seller ref="seller" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('seller')"
              :class="[
                'iconfont',
                fullScreenStatus.seller ? 'icon-compress-alt' : 'icon-expand-alt',
              ]"
            ></span>
          </div>
        </div>
      </section>
      <section class="screen-middle">
        <div id="middle-top" :class="[fullScreenStatus.map ? 'fullscreen' : '']">
          <!-- å•†å®¶åˆ†å¸ƒå›¾è¡¨ -->
          <Map ref="map" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('map')"
              :class="['iconfont', fullScreenStatus.map ? 'icon-compress-alt' : 'icon-expand-alt']"
            ></span>
          </div>
        </div>
        <div id="middle-bottom" :class="[fullScreenStatus.rank ? 'fullscreen' : '']">
          <!-- åœ°åŒºé”€é‡æ’è¡Œå›¾è¡¨ -->
          <Rank ref="rank" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('rank')"
              :class="['iconfont', fullScreenStatus.rank ? 'icon-compress-alt' : 'icon-expand-alt']"
            ></span>
          </div>
        </div>
      </section>
      <section class="screen-right">
        <div id="right-top" :class="[fullScreenStatus.hot ? 'fullscreen' : '']">
          <!-- çƒ­é”€å•†å“å æ¯”å›¾è¡¨ -->
          <hot ref="hot" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('hot')"
              :class="['iconfont', fullScreenStatus.hot ? 'icon-compress-alt' : 'icon-expand-alt']"
            ></span>
          </div>
        </div>
        <div id="right-bottom" :class="[fullScreenStatus.stock ? 'fullscreen' : '']">
          <!-- åº“å­˜é”€é‡åˆ†æå›¾è¡¨ -->
          <Stock ref="stock" />
          <div class="resize">
            <!-- icon-compress-alt -->
            <span
              @click="changeSize('stock')"
              :class="[
                'iconfont',
                fullScreenStatus.stock ? 'icon-compress-alt' : 'icon-expand-alt',
              ]"
            ></span>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script>
import Hot from '@/components/Hot.vue'
import Map from '@/components/Map.vue'
import Rank from '@/components/Rank.vue'
import Seller from '@/components/Seller.vue'
import Stock from '@/components/Stock.vue'
import Trend from '@/components/Trend.vue'
import { mapState } from 'vuex'
import { getThemeValue } from '@/utils/theme_utils'
export default {
  components: {
    Hot,
    Map,
    Rank,
    Seller,
    Stock,
    Trend,
  },
  data() {
    return {
      // å®šä¹‰æ¯ä¸€ä¸ªå›¾è¡¨çš„å…¨å±çŠ¶æ€
      fullScreenStatus: {
        trend: false,
        seller: false,
        map: false,
        rank: false,
        hot: false,
        stock: false,
      },
      timer: null,
      timeValue: '',
    }
  },
  created() {
    // æ³¨å†Œæ¥æ”¶åˆ°æ•°æ®çš„å›è°ƒå‡½æ•°
    this.$socket.registerCallBack('fullScreen', this.recvData)
    this.$socket.registerCallBack('themeChange', this.recvThemeChange)
  },
  destroyed() {
    this.$socket.unRegisterCallBack('fullScreen')
    this.$socket.unRegisterCallBack('themeChange')
    clearInterval(this.timer)
  },
  mounted() {
    this.displayTime()
    if (this.timer) {
      clearInterval(this.timer)
    }
    this.timer = setInterval(() => {
      this.displayTime()
    }, 1000)
  },
  methods: {
    displayTime() {
      //è·å–ç³»ç»Ÿå½“å‰çš„å¹´ã€æœˆã€æ—¥ã€å°æ—¶ã€åˆ†é’Ÿã€æ¯«ç§’
      let date, year, month, day, h, m, s
      date = new Date()
      year = date.getFullYear()
      month = date.getMonth() + 1
      day = date.getDate()
      h = date.getHours()
      m = date.getMinutes()
      s = date.getSeconds()
      month = month < 10 ? '0' + month : month
      day = day < 10 ? '0' + day : day
      h = h < 10 ? '0' + h : h
      m = m < 10 ? '0' + m : m
      s = s < 10 ? '0' + s : s
      return (this.timeValue = year + '-' + month + '-' + day + '  ' + h + ':' + m + ':' + s)
    },
    changeSize(chartName) {
      console.log(chartName)
      // å°†æ•°æ®å‘é€ç»™æœåŠ¡ç«¯
      const targetValue = !this.fullScreenStatus[chartName]
      this.$socket.send({
        action: 'fullScreen',
        socketType: 'fullScreen',
        chartName: chartName,
        value: targetValue,
      })
    },
    // æ¥æ”¶åˆ°å…¨å±æ•°æ®ä¹‹åçš„å¤„ç†
    recvData(data) {
      // å–å‡ºæ˜¯å“ªä¸€ä¸ªå›¾è¡¨éœ€è¦è¿›è¡Œåˆ‡æ¢
      const chartName = data.chartName
      // å–å‡º, åˆ‡æ¢æˆä»€ä¹ˆçŠ¶æ€
      const targetValue = data.value
      this.fullScreenStatus[chartName] = targetValue
      this.$nextTick(() => {
        this.$refs[chartName].screenAdapter()
      })
    },
    handleChangeTheme() {
      // ä¿®æ”¹VueXä¸­æ•°æ®
      this.$socket.send({
        action: 'themeChange',
        socketType: 'themeChange',
        chartName: '',
        value: '',
      })
    },
    recvThemeChange() {
      this.$store.commit('changeTheme')
    },
  },
  computed: {
    logoSrc() {
      return '/static/img/' + getThemeValue(this.theme).logoSrc
    },
    headerSrc() {
      return '/static/img/' + getThemeValue(this.theme).headerBorderSrc
    },
    themeSrc() {
      return '/static/img/' + getThemeValue(this.theme).themeSrc
    },
    containerStyle() {
      return {
        backgroundColor: getThemeValue(this.theme).backgroundColor,
        color: getThemeValue(this.theme).titleColor,
      }
    },
    ...mapState(['theme']),
  },
}
</script>

<style lang="less" scoped>
// å…¨å±æ ·å¼çš„å®šä¹‰
.fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
  z-index: 9999;
}

.screen-container {
  width: 100%;
  height: 100%;
  padding: 0 20px;
  background-color: #2e2e2f;
  color: #fff;
  box-sizing: border-box;
}
.screen-header {
  width: 100%;
  font-size: 20px;
  position: relative;
  > div {
    img {
      width: 100%;
    }
  }
  .title {
    position: absolute;
    left: 50%;
    top: 50%;
    font-size: 20px;
    transform: translate(-50%, -50%);
  }
  .title-right {
    display: flex;
    align-items: center;
    position: absolute;
    right: 0px;
    top: 50%;
    transform: translateY(-80%);
  }
  .qiehuan {
    width: 28px;
    height: 21px;
    cursor: pointer;
  }
  .datetime {
    font-size: 15px;
    margin-left: 10px;
  }
  .logo {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-80%);
    img {
      height: 35px;
      width: 154px;
    }
  }
}
.screen-body {
  width: 100%;
  height: 100%;
  display: flex;
  margin-top: 10px;
  .screen-left {
    height: 100%;
    width: 27.6%;
    #left-top {
      height: 53%;
      position: relative;
    }
    #left-bottom {
      height: 31%;
      margin-top: 25px;
      position: relative;
    }
  }
  .screen-middle {
    height: 100%;
    width: 41.5%;
    margin-left: 1.6%;
    margin-right: 1.6%;
    #middle-top {
      width: 100%;
      height: 56%;
      position: relative;
    }
    #middle-bottom {
      margin-top: 25px;
      width: 100%;
      height: 28%;
      position: relative;
    }
  }
  .screen-right {
    height: 100%;
    width: 27.6%;
    #right-top {
      height: 46%;
      position: relative;
    }
    #right-bottom {
      height: 38%;
      margin-top: 25px;
      position: relative;
    }
  }
}
.resize {
  position: absolute;
  right: 20px;
  top: 20px;
  cursor: pointer;
}
</style>
```

#### 4.3.5 å…¨å±åˆ‡æ¢

- å…¨å±çŠ¶æ€æ•°æ®å®šä¹‰

```vue
export default { data() { return { // å®šä¹‰æ¯ä¸€ä¸ªå›¾è¡¨çš„å…¨å±çŠ¶æ€ fullScreenStatus: { trend: false,
seller: false, map: false, rank: false, hot: false, stock: false, }, timer: null, timeValue: '', }
}, }
```

- å…¨å±çŠ¶æ€æ ·å¼å®šä¹‰

```vue
<style lang="less" scoped>
// å…¨å±æ ·å¼çš„å®šä¹‰
.fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  margin: 0 !important;
  z-index: 9999;
}
</style>
```

- classå€¼å¾—å¤„ç†

```html
<div id="left-top" :class="[fullScreenStatus.trend ? 'fullscreen' : '']">
  <!-- é”€é‡è¶‹åŠ¿å›¾è¡¨ -->
  <Trend ref="trend" />
  <div class="resize">
    <!-- icon-compress-alt -->
    <span
      @click="changeSize('trend')"
      :class="[
          'iconfont',
          fullScreenStatus.trend
            ? 'icon-compress-alt'
            : 'icon-expand-alt',
        ]"
    ></span>
  </div>
</div>
```

- å…¨å±ç‚¹å‡»äº‹ä»¶çš„å¤„ç†

```vue
export default { methods: { changeSize(chartName) { console.log(chartName) // å°†æ•°æ®å‘é€ç»™æœåŠ¡ç«¯
const targetValue = !this.fullScreenStatus[chartName] this.$socket.send({ action: 'fullScreen',
socketType: 'fullScreen', chartName: chartName, value: targetValue, }) }, }, }
```

- createdæ—¶æ³¨å†Œå›è°ƒå‡½æ•°

```vue
export default { created() { // æ³¨å†Œæ¥æ”¶åˆ°æ•°æ®çš„å›è°ƒå‡½æ•° this.$socket.registerCallBack('fullScreen',
this.recvData) this.$socket.registerCallBack('themeChange', this.recvThemeChange) }, }
```

- destoryedæ—¶å–æ¶ˆå›è°ƒå‡½æ•°

```vue
export default { destroyed() { this.$socket.unRegisterCallBack('fullScreen')
this.$socket.unRegisterCallBack('themeChange') clearInterval(this.timer) }, }
```

- å¾—åˆ°æ•°æ®çš„å¤„ç†

```vue
export default { methods: { // æ¥æ”¶åˆ°å…¨å±æ•°æ®ä¹‹åçš„å¤„ç† recvData(data) { //
å–å‡ºæ˜¯å“ªä¸€ä¸ªå›¾è¡¨éœ€è¦è¿›è¡Œåˆ‡æ¢ const chartName = data.chartName // å–å‡º, åˆ‡æ¢æˆä»€ä¹ˆçŠ¶æ€ const
targetValue = data.value this.fullScreenStatus[chartName] = targetValue this.$nextTick(() => {
this.$refs[chartName].screenAdapter() }) }, }, }
```

- socket_service.js ä»£ç å¦‚ä¸‹ï¼š

```js
const action = recvData.action
if (action === 'getData') {
  const realData = JSON.parse(recvData.data)
  this.callBackMapping[socketType].call(this, realData)
} else if (action === 'fullScreen') {
  this.callBackMapping[socketType].call(this, recvData)
} else if (action === 'themeChange') {
  this.callBackMapping[socketType].call(this, recvData)
}
```

#### 4.3.6 ä¸»é¢˜åˆ‡æ¢

- å½“å‰ä¸»é¢˜æ•°æ®çš„å­˜å‚¨

å½“å‰ä¸»é¢˜çš„æ•°æ®, ä¼šåœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨, å› æ­¤è®¾ç½®åœ¨ VueX ä¸­æ˜¯æœ€åˆé€‚çš„, å¢åŠ ä»“åº“æ•°æ® theme , å¹¶å¢åŠ ä¸€ä¸ª mutation ç”¨æ¥ä¿®æ”¹ theme

```js
// store/index.js
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
    theme: 'dark',
  },
  mutations: {
    changeTheme(state) {
      if (state.theme === 'dark') {
        state.theme = 'default'
      } else {
        state.theme = 'dark'
      }
    },
  },
  actions: {},
  modules: {},
})
```

- ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜æŒ‰é’®

ç‚¹å‡»äº‹ä»¶çš„å“åº”

```vue
<template>
  <div class="title-right">
    <img :src="themeSrc" class="qiehuan" @click="handleChangeTheme" />
    <span class="datetime">{{ timeValue }}</span>
  </div>
</template>
```

ç‚¹å‡»äº‹ä»¶çš„å¤„ç†

```vue
export default { methods: { handleChangeTheme() { // ä¿®æ”¹VueXä¸­æ•°æ® this.$socket.send({ action:
"themeChange", socketType: "themeChange", chartName: "", value: "", }); } } }
```

- ç›‘å¬ä¸»é¢˜çš„å˜åŒ–

ä»¥ Seller.vue ä¸ºä¾‹, è¿›è¡Œä¸»é¢˜æ•°æ®å˜åŒ–çš„ç›‘å¬

æ˜ å°„ store ä¸­çš„ theme ä½œä¸ºå½“å‰ç»„ä»¶çš„è®¡ç®—å±æ€§

```vue
import { mapState } from 'vuex' export default { computed: { ...mapState(['theme']); } }
```

ç›‘å¬themeçš„å˜åŒ–

```vue
export default { watch: { theme () { this.myChart.dispose(); // é”€æ¯å½“å‰çš„å›¾è¡¨ this.initChart(); //
é‡æ–°ä»¥æœ€æ–°çš„ä¸»é¢˜åç§°åˆå§‹åŒ–å›¾è¡¨å¯¹è±¡ this.screenAdapter(); // å®Œæˆå±å¹•é€‚é… this.updateChart(); //
æ›´æ–°å›¾è¡¨å±•ç¤º } } }
```

ä¸»é¢˜çš„åˆ‡æ¢

```vue
export default { methods: { // åˆå§‹åŒ–echartsInstanceå¯¹è±¡ initChart() { this.myChart =
this.$echarts.init(this.$refs.seller_ref, this.theme); } } }
```

é€šè¿‡è¿™ä¸ªæ­¥éª¤å°±å¯ä»¥å®ç°æ¯ä¸€ä¸ªå›¾è¡¨ç»„ä»¶åˆ‡æ¢ä¸»é¢˜äº†ï¼Œä¸è¿‡æœ‰éƒ¨åˆ†æ ·å¼éœ€è¦å¦å¤–è°ƒæ•´

- ä¸»é¢˜æ ·å¼é€‚é…

åˆ›å»ºutils/theme_utils.jsæ–‡ä»¶

å®šä¹‰ä¸¤ä¸ªä¸»é¢˜ä¸‹, éœ€è¦è¿›è¡Œæ ·å¼åˆ‡æ¢çš„æ ·å¼æ•°æ®, å¹¶å¯¹å¤–å¯¼å‡ºä¸€ä¸ªå‡½æ•°, ç”¨äºæ–¹ä¾¿çš„é€šè¿‡ä¸»é¢˜åç§°å¾—åˆ°å¯¹åº”ä¸»é¢˜çš„æŸäº›é…ç½®é¡¹

```js
const theme = {
  dark: {
    // èƒŒæ™¯é¢œè‰²
    backgroundColor: '#3f3f46',
    // å›¾è¡¨èƒŒæ™¯è‰²
    bgColor: '#100c2a',
    // labelæ–‡å­—é¢œè‰²
    labelColor: '#fff',
    // æ ‡é¢˜çš„æ–‡å­—é¢œè‰²
    titleColor: '#fff',
    // å·¦ä¸Šè§’logoçš„å›¾æ ‡è·¯å¾„
    logoSrc: 'logo_dark.png',
    // åˆ‡æ¢ä¸»é¢˜æŒ‰é’®çš„å›¾ç‰‡è·¯å¾„
    themeSrc: 'qiehuan_dark.png',
    // é¡µé¢é¡¶éƒ¨çš„è¾¹æ¡†å›¾ç‰‡
    headerBorderSrc: 'header_border_dark.png',
  },
  default: {
    // èƒŒæ™¯é¢œè‰²
    backgroundColor: '#eee',
    // å›¾è¡¨èƒŒæ™¯è‰²
    bgColor: '#fff',
    // labelæ–‡å­—é¢œè‰²
    labelColor: '#100c2a',
    // æ ‡é¢˜çš„æ–‡å­—é¢œè‰²
    titleColor: '#000',
    // å·¦ä¸Šè§’logoçš„å›¾æ ‡è·¯å¾„
    logoSrc: 'logo_light.png',
    // åˆ‡æ¢ä¸»é¢˜æŒ‰é’®çš„å›¾ç‰‡è·¯å¾„
    themeSrc: 'qiehuan_light.png',
    // é¡µé¢é¡¶éƒ¨çš„è¾¹æ¡†å›¾ç‰‡
    headerBorderSrc: 'header_border_light.png',
  },
}

export function getThemeValue(themeName) {
  return theme[themeName]
}
```

æ˜ å°„ VueX ä¸­çš„ theme æ•°æ®ä½œä¸ºè¯¥ç»„ä»¶çš„è®¡ç®—å±æ€§

```vue
// screenPage.vue import { mapState } from 'vuex' export default { computed: {
...mapState(['theme']) }
```

å®šä¹‰ä¸€äº›æ§åˆ¶æ ·å¼çš„è®¡ç®—å±æ€§

```vue
// screenPage.vue import { mapState } from "vuex"; import { getThemeValue } from
"@/utils/theme_utils"; export default { computed: { logoSrc() { return "/static/img/" +
getThemeValue(this.theme).logoSrc; }, headerSrc() { return "/static/img/" +
getThemeValue(this.theme).headerBorderSrc; }, themeSrc() { return "/static/img/" +
getThemeValue(this.theme).themeSrc; }, containerStyle() { return { backgroundColor:
getThemeValue(this.theme).backgroundColor, color: getThemeValue(this.theme).titleColor, }; } } }, }
```

å°†è®¡ç®—å±æ€§åº”ç”¨åˆ°å¸ƒå±€ä¸­

```vue
<template>
  <div class="screen-container" :style="containerStyle">
    <header class="screen-header">
      <div>
        <img :src="headerSrc" alt="" />
      </div>
      <span class="logo">
        <img :src="logoSrc" alt="" />
      </span>
      <span class="title">ç”µå•†å¹³å°æ•°æ®å¤§å±å®æ—¶ç›‘æ§ç³»ç»Ÿ</span>
      <div class="title-right">
        <img :src="themeSrc" class="qiehuan" @click="handleChangeTheme" />
        <span class="datetime">{{ timeValue }}</span>
      </div>
    </header>
  </div>
</template>
```

é€šè¿‡è®¡ç®—å±æ€§åŠ¨æ€æ§åˆ¶æ ‡é¢˜æ ·å¼åŠä¸‹æ‹‰æ¡†é€‰é¡¹

```vue
// trend.vue import { mapState } from "vuex"; import { getThemeValue } from "@/utils/theme_utils";
export default { ...mapState(["theme"]), selectTypes() { if (!this.allData) { return []; } else {
return this.allData.type.filter((item) => { return item.key !== this.choiceType; }); } },
showTitle() { if (!this.allData) { return ""; } else { return this.allData[this.choiceType].title; }
}, // è®¾ç½®ç»™æ ‡é¢˜çš„æ ·å¼ comStyle() { return { fontSize: this.titleFontSize + "px", color:
getThemeValue(this.theme).labelColor }; }, marginStyle() { return { marginLeft: this.titleFontSize +
"px", backgroundColor: getThemeValue(this.theme).bgColor }; }, }
```

## 5. å†™åœ¨æœ€å

- å‡çº§Echartsæ–°ç‰ˆæœ¬
- å¿«é€ŸæŒæ¡KOA2åç«¯æ¡†æ¶å¼€å‘API
- ä»£ç ç®€æ´ä¼˜åŒ–åŠåŠŸèƒ½å®Œå–„
- Axioså’ŒWebSocketä¸¤ç§é€šä¿¡æ–¹å¼è®²è§£
- é€‚åˆè¿›é˜¶æ•°æ®å¯è§†åŒ–çš„ç»ƒæ‰‹é¡¹ç›®

> å¦‚æœå¯¹ä½ æœ‰äº›è®¸å¸®åŠ©ï¼Œæ¬¢è¿èµèµã€è½¬å‘åˆ†äº«ï¼Œæ„Ÿè°¢æ”¯æŒã€‚å¦‚éœ€è·å–æ›´å¤šå®æˆ˜é¡¹ç›®ç»éªŒæˆ–æºç èµ„æºï¼Œè¯·å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š`ã€Œæ‡’äººç å†œã€`ï¼Œä¹Ÿå¯ä»¥åŠ æˆ‘å¾®ä¿¡`lazycode520`ï¼Œä¸€èµ·å­¦ä¹ ä¸€èµ·è¿›æ­¥ã€‚

æŸ¥çœ‹å®Œæ•´æºä»£ç ï¼Œè¯·ç§»æ­¥åˆ°githubè®¿é—®ğŸ‘‰ï¼š[https://github.com/jackchen0120/EC-Platform-Monitor](https://github.com/jackchen0120/EC-Platform-Monitor)
